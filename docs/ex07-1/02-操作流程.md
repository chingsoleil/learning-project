# 操作流程

## 使用者端流程

### 主要測驗流程

```
首頁 (Home)
  ↓ [點擊「開始測驗」]
測驗介紹頁 (TestIntro)
  ↓ [點擊「開始測驗」]
個人資訊填寫頁 (UserInfo)
  ↓ [填寫並提交]
答題頁 (Questions)
  ↓ [完成所有題目並提交]
測驗結果頁 (TestResult)
  ↓ [點擊「查看完整報告」]
詳細報告頁 (DetailedReport)
```

### 歷史記錄查詢流程

```
首頁 (Home)
  ↓ [點擊「查看報告」]
歷史記錄查詢頁 (TestHistory)
  ↓ [輸入 Email + 電話驗證]
  ↓ [顯示歷史記錄列表]
  ↓ [點擊「查看報告」]
詳細報告頁 (DetailedReport)
```

### 測驗結果頁操作流程

```
測驗結果頁 (TestResult)
  ├─ [點擊「查看完整報告」] → 詳細報告頁
  ├─ [點擊「下載 PDF」] → 下載 PDF 檔案
  ├─ [點擊「分享結果」] → 分享功能（複製連結/社群分享）
  └─ [點擊「重新測驗」] → 返回測驗介紹頁
```

### 詳細報告頁操作流程

```
詳細報告頁 (DetailedReport)
  ├─ [展開/折疊各維度分析]
  ├─ [填寫諮詢表單] → 提交諮詢請求
  └─ [點擊「返回」] → 返回測驗結果頁
```

## 管理系統流程

### 登入流程

```
管理員登入頁 (Login)
  ↓ [輸入帳號密碼]
  ↓ [驗證成功]
儀表板 (Dashboard)
```

### 測驗管理流程

```
儀表板 (Dashboard)
  ↓ [點擊「測驗管理」]
測驗管理頁 (TestManagement)
  ├─ [新增測驗] → 新增測驗表單
  ├─ [編輯測驗] → 編輯測驗表單
  ├─ [刪除測驗] → 確認刪除
  └─ [啟用/停用] → 切換狀態
```

### 題目管理流程

```
測驗管理頁 (TestManagement)
  ↓ [點擊測驗的「管理題目」]
題目管理頁 (QuestionManagement)
  ├─ [查看題目列表]
  ├─ [新增題目] → 新增題目表單
  ├─ [編輯題目] → 編輯題目表單
  └─ [刪除題目] → 確認刪除
```

### 使用者管理流程

```
儀表板 (Dashboard)
  ↓ [點擊「使用者管理」]
使用者管理頁 (UserManagement)
  ├─ [查看使用者列表]
  ├─ [查看詳細資訊] → 使用者詳情（含測驗歷史）
  └─ [操作] → 相關操作
```

### 諮詢管理流程

```
儀表板 (Dashboard)
  ↓ [點擊「諮詢管理」]
諮詢管理頁 (ConsultationManagement)
  ├─ [查看諮詢列表]
  ├─ [查看詳細內容] → 諮詢詳情
  ├─ [更新狀態] → 待處理/處理中/已完成
  └─ [回覆諮詢] → 回覆功能
```

### 報告管理流程

```
儀表板 (Dashboard)
  ↓ [點擊「報告管理」]
報告管理頁 (ReportManagement)
  ├─ [查看報告統計]
  ├─ [篩選報告] → 依日期/測驗類型/使用者
  └─ [匯出報告] → 匯出功能
```

## 資料流程

### 測驗作答資料流程

```
1. 使用者填寫個人資訊
   → 建立 TestSession 記錄（Status: NotStarted）
   
2. 開始作答
   → 更新 TestSession（Status: InProgress, StartedAt）
   → 每題作答時建立/更新 TestAnswer 記錄
   → LocalStorage 暫存（防止資料遺失）
   
3. 完成測驗
   → 更新 TestSession（Status: Completed, CompletedAt）
   → 計算各維度分數
   → 生成測驗結果
   
4. 查看報告
   → 從 TestSession + TestAnswer 計算分數
   → 顯示詳細分析
```

### 諮詢流程

```
1. 使用者在詳細報告頁填寫諮詢表單
   → 建立 Consultation 記錄（Status: Pending）
   
2. 管理員在諮詢管理頁查看
   → 更新狀態（Status: InProgress）
   
3. 管理員回覆
   → 更新狀態（Status: Completed）
   → 記錄回覆內容
```

## 權限控制

### 路由守衛

- **使用者端**: 無需登入，可直接訪問
- **管理系統**: 
  - 需要驗證 `adminToken`（存在 localStorage）
  - 未登入自動跳轉到登入頁
  - 使用 `meta: { requiresAuth: true }` 標記

### 資料存取控制

- **使用者端**: 
  - 只能查看自己的測驗記錄（透過 Email + 電話驗證）
  - 無法修改已完成的測驗
  
- **管理系統**:
  - 可查看所有資料
  - 可進行 CRUD 操作
  - 需要管理員權限

## 狀態管理

### Pinia Store (test.js)

- **currentTest**: 當前測驗資料
- **userInfo**: 使用者資訊
- **answers**: 作答記錄（物件，key 為 questionId）
- **currentQuestionIndex**: 當前題目索引
- **isAllAnswered**: 是否全部作答（computed）
- **progress**: 作答進度百分比（computed）

### LocalStorage 儲存

- **testProgress**: 測驗進度（自動儲存）
  - userInfo
  - answers
  - currentQuestionIndex
  - timestamp

- **adminToken**: 管理員登入 token

