# ç®¡ç†çµ±è¨ˆæ¨¡çµ„

## æ¦‚è¿°

ç®¡ç†çµ±è¨ˆæ¨¡çµ„æ˜¯ç®¡ç†ç³»çµ±çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›æ•¸æ“šåˆ†æã€å ±è¡¨ç”Ÿæˆã€è¶¨å‹¢ç›£æ§ç­‰åŠŸèƒ½ï¼Œå¹«åŠ©ç®¡ç†è€…äº†è§£ç³»çµ±é‹ç‡Ÿç‹€æ³å’Œä½¿ç”¨è€…è¡Œç‚ºã€‚

---

## å„€è¡¨æ¿çµ±è¨ˆï¼ˆDashboardï¼‰

### æ ¸å¿ƒçµ±è¨ˆæŒ‡æ¨™

#### 1. ç¸½æ¸¬é©—æ•¸
- **å®šç¾©**: æ‰€æœ‰å®Œæˆçš„æ¸¬é©—è¨˜éŒ„æ•¸
- **è¨ˆç®—**: `COUNT(TestSession WHERE Status = 'Completed')`
- **æ™‚é–“ç¯„åœ**: å…¨éƒ¨æ™‚é–“ã€æœ¬æœˆã€æœ¬é€±
- **è®ŠåŒ–è¶¨å‹¢**: è¼ƒä¸Šæœˆ/ä¸Šé€±çš„è®ŠåŒ–ç™¾åˆ†æ¯”

#### 2. å®Œæˆç‡
- **å®šç¾©**: å®Œæˆæ¸¬é©—æ•¸ / é–‹å§‹æ¸¬é©—æ•¸
- **è¨ˆç®—**: 
  ```sql
  COUNT(Status = 'Completed') / COUNT(Status IN ('InProgress', 'Completed'))
  ```
- **ç›®æ¨™**: ç¶­æŒåœ¨ 70% ä»¥ä¸Š

#### 3. æ´»èºä½¿ç”¨è€…
- **å®šç¾©**: éå» 30 å¤©å…§å®Œæˆæ¸¬é©—çš„ä½¿ç”¨è€…æ•¸
- **è¨ˆç®—**: `COUNT(DISTINCT Email WHERE CompletedAt >= DATEADD(day, -30, GETDATE()))`
- **å»é‡**: ä¾ Email æˆ– Phone

#### 4. è«®è©¢è«‹æ±‚æ•¸
- **å®šç¾©**: å¾…è™•ç†çš„è«®è©¢è«‹æ±‚æ•¸
- **è¨ˆç®—**: `COUNT(Consultation WHERE Status = 'Pending')`
- **è­¦ç¤º**: è¶…é 10 ç­†éœ€è™•ç†

---

### åœ–è¡¨çµ±è¨ˆ

#### 1. è¿‘30å¤©æ¸¬é©—è¶¨å‹¢ï¼ˆæŠ˜ç·šåœ–ï¼‰
- **X è»¸**: æ—¥æœŸï¼ˆ30å¤©ï¼‰
- **Y è»¸**: å®Œæˆæ¸¬é©—æ•¸
- **æ•¸æ“šä¾†æº**: 
  ```sql
  SELECT 
      CAST(CompletedAt AS DATE) AS Date,
      COUNT(*) AS Count
  FROM TestSession
  WHERE CompletedAt >= DATEADD(day, -30, GETDATE())
      AND Status = 'Completed'
  GROUP BY CAST(CompletedAt AS DATE)
  ORDER BY Date
  ```

#### 2. æ¸¬é©—é¡å‹åˆ†å¸ƒï¼ˆåœ“é¤…åœ–ï¼‰
- **æ•¸æ“šä¾†æº**:
  ```sql
  SELECT 
      tp.Name AS TestName,
      COUNT(*) AS Count
  FROM TestSession ts
  INNER JOIN TestPaper tp ON ts.TestPaperId = tp.Id
  WHERE ts.Status = 'Completed'
  GROUP BY tp.Name
  ```

#### 3. å¹´é½¡åˆ†å¸ƒï¼ˆé•·æ¢åœ–ï¼‰
- **åˆ†çµ„**: 13-17, 18-24, 25-34, 35-44, 45-54, 55+
- **æ•¸æ“šä¾†æº**:
  ```sql
  SELECT 
      CASE 
          WHEN Age BETWEEN 13 AND 17 THEN '13-17'
          WHEN Age BETWEEN 18 AND 24 THEN '18-24'
          WHEN Age BETWEEN 25 AND 34 THEN '25-34'
          WHEN Age BETWEEN 35 AND 44 THEN '35-44'
          WHEN Age BETWEEN 45 AND 54 THEN '45-54'
          ELSE '55+'
      END AS AgeGroup,
      COUNT(*) AS Count
  FROM TestSession
  WHERE Status = 'Completed' AND Age IS NOT NULL
  GROUP BY AgeGroup
  ```

#### 4. æ€§åˆ¥åˆ†å¸ƒï¼ˆåœ“é¤…åœ–ï¼‰
- **æ•¸æ“šä¾†æº**:
  ```sql
  SELECT 
      Gender,
      COUNT(*) AS Count
  FROM TestSession
  WHERE Status = 'Completed' AND Gender IS NOT NULL
  GROUP BY Gender
  ```

---

## æ¸¬é©—åˆ†ææ¨¡çµ„

### æ¸¬é©—å®Œæˆåº¦åˆ†æ

#### å®Œæˆç‡çµ±è¨ˆ
- **æ•´é«”å®Œæˆç‡**: æ‰€æœ‰æ¸¬é©—çš„å®Œæˆç‡
- **å„æ¸¬é©—å®Œæˆç‡**: æ¯å€‹æ¸¬å·çš„å®Œæˆç‡
- **æ™‚é–“è¶¨å‹¢**: å®Œæˆç‡éš¨æ™‚é–“çš„è®ŠåŒ–

#### æ”¾æ£„é»åˆ†æ
- **åˆ†æ**: ä½¿ç”¨è€…åœ¨å“ªä¸€é¡Œæ”¾æ£„æ¸¬é©—
- **ç›®çš„**: æ‰¾å‡ºå›°é›£é¡Œç›®æˆ–æ”¹å–„é»
- **æ•¸æ“šä¾†æº**: `TestAnswer` çš„æœ€å¾Œä¸€ç­†è¨˜éŒ„

---

### ä½œç­”æ™‚é–“åˆ†æ

#### å¹³å‡ä½œç­”æ™‚é–“
- **è¨ˆç®—**: `AVG(DATEDIFF(minute, StartedAt, CompletedAt))`
- **åˆ†çµ„**: ä¾æ¸¬é©—é¡å‹ã€å¹´é½¡ã€æ€§åˆ¥

#### ä½œç­”æ™‚é–“åˆ†å¸ƒ
- **åˆ†çµ„**: <10åˆ†é˜, 10-15åˆ†é˜, 15-20åˆ†é˜, 20-30åˆ†é˜, >30åˆ†é˜
- **ç›®çš„**: äº†è§£ä½¿ç”¨è€…ä½œç­”ç¿’æ…£

---

### åˆ†æ•¸åˆ†å¸ƒåˆ†æ

#### å„ç‰¹è³ªåˆ†æ•¸åˆ†å¸ƒ
- **çµ±è¨ˆ**: æ¯å€‹ç‰¹è³ªçš„å¹³å‡åˆ†ã€ä¸­ä½æ•¸ã€æ¨™æº–å·®
- **åœ–è¡¨**: ç®±ç·šåœ–ã€ç›´æ–¹åœ–
- **æ•¸æ“šä¾†æº**: `TestScore` è¡¨

#### åˆ†æ•¸è¶¨å‹¢åˆ†æ
- **æ™‚é–“è¶¨å‹¢**: å„ç‰¹è³ªåˆ†æ•¸éš¨æ™‚é–“çš„è®ŠåŒ–
- **ç›®çš„**: äº†è§£æ•´é«”è¶¨å‹¢

---

## ä½¿ç”¨è€…åˆ†ææ¨¡çµ„

### ä½¿ç”¨è€…ç•«åƒ

#### åŸºæœ¬çµ±è¨ˆ
- **ç¸½ä½¿ç”¨è€…æ•¸**: `COUNT(DISTINCT Email, Phone)`
- **æ–°ä½¿ç”¨è€…**: æœ¬æœˆæ–°å¢
- **å›è¨ªä½¿ç”¨è€…**: å®Œæˆå¤šæ¬¡æ¸¬é©—çš„ä½¿ç”¨è€…

#### ä½¿ç”¨è€…è¡Œç‚º
- **æ¸¬é©—æ¬¡æ•¸åˆ†å¸ƒ**: 1æ¬¡ã€2-3æ¬¡ã€4-5æ¬¡ã€5æ¬¡ä»¥ä¸Š
- **æ¸¬é©—é–“éš”**: å…©æ¬¡æ¸¬é©—ä¹‹é–“çš„æ™‚é–“é–“éš”
- **åå¥½æ¸¬é©—**: ä½¿ç”¨è€…æœ€å¸¸é¸æ“‡çš„æ¸¬é©—é¡å‹

---

### ä½¿ç”¨è€…ç•™å­˜åˆ†æ

#### ç•™å­˜ç‡
- **æ¬¡æ—¥ç•™å­˜**: å®Œæˆæ¸¬é©—å¾Œæ¬¡æ—¥å›è¨ªçš„æ¯”ä¾‹
- **7æ—¥ç•™å­˜**: å®Œæˆæ¸¬é©—å¾Œ7æ—¥å…§å›è¨ªçš„æ¯”ä¾‹
- **30æ—¥ç•™å­˜**: å®Œæˆæ¸¬é©—å¾Œ30æ—¥å…§å›è¨ªçš„æ¯”ä¾‹

#### æµå¤±åˆ†æ
- **æµå¤±å®šç¾©**: 30å¤©å…§æœªå›è¨ª
- **æµå¤±åŸå› **: åˆ†æå¯èƒ½åŸå› ï¼ˆéœ€å•å·èª¿æŸ¥ï¼‰

---

## è«®è©¢åˆ†ææ¨¡çµ„

### è«®è©¢çµ±è¨ˆ

#### è«®è©¢é‡çµ±è¨ˆ
- **ç¸½è«®è©¢æ•¸**: `COUNT(Consultation)`
- **å¾…è™•ç†æ•¸**: `COUNT(WHERE Status = 'Pending')`
- **è™•ç†ä¸­æ•¸**: `COUNT(WHERE Status = 'InProgress')`
- **å·²å®Œæˆæ•¸**: `COUNT(WHERE Status = 'Completed')`

#### è«®è©¢é¡åˆ¥åˆ†å¸ƒ
- **æ•¸æ“šä¾†æº**:
  ```sql
  SELECT 
      Category,
      COUNT(*) AS Count
  FROM Consultation
  GROUP BY Category
  ```

#### è™•ç†æ™‚é–“åˆ†æ
- **å¹³å‡è™•ç†æ™‚é–“**: `AVG(DATEDIFF(hour, CreatedAt, RepliedAt))`
- **ç›®çš„**: è©•ä¼°æœå‹™æ•ˆç‡

---

### è«®è©¢å“è³ªåˆ†æ

#### å›è¦†ç‡
- **è¨ˆç®—**: `COUNT(RepliedAt IS NOT NULL) / COUNT(*)`
- **ç›®æ¨™**: ç¶­æŒåœ¨ 90% ä»¥ä¸Š

#### ä½¿ç”¨è€…æ»¿æ„åº¦
- **æ•¸æ“šä¾†æº**: æœªä¾†å¯åŠ å…¥æ»¿æ„åº¦èª¿æŸ¥
- **ç›®å‰**: æš«ç„¡æ•¸æ“š

---

## å ±å‘Šç®¡ç†æ¨¡çµ„

### å ±å‘Šçµ±è¨ˆ

#### å ±å‘Šç”Ÿæˆçµ±è¨ˆ
- **ç¸½å ±å‘Šæ•¸**: `COUNT(TestSession WHERE Status = 'Completed')`
- **å ±å‘ŠæŸ¥çœ‹ç‡**: æŸ¥çœ‹å ±å‘Šçš„ä½¿ç”¨è€…æ¯”ä¾‹
- **å ±å‘Šä¸‹è¼‰æ•¸**: PDF ä¸‹è¼‰æ¬¡æ•¸ï¼ˆéœ€è¨˜éŒ„ï¼‰

#### å ±å‘Šé¡å‹åˆ†å¸ƒ
- **æ‘˜è¦å ±å‘Š**: åªçœ‹çµæœé 
- **è©³ç´°å ±å‘Š**: æŸ¥çœ‹è©³ç´°å ±å‘Šé 
- **ä¸‹è¼‰å ±å‘Š**: ä¸‹è¼‰ PDF

---

### å ±å‘Šå…§å®¹åˆ†æ

#### æœ€å¸¸æŸ¥çœ‹çš„ç¶­åº¦
- **çµ±è¨ˆ**: è©³ç´°å ±å‘Šé ä¸­å„ç¶­åº¦çš„å±•é–‹æ¬¡æ•¸
- **ç›®çš„**: äº†è§£ä½¿ç”¨è€…æœ€é—œå¿ƒçš„ç‰¹è³ª

#### å ±å‘Šåˆ†äº«çµ±è¨ˆ
- **åˆ†äº«æ¬¡æ•¸**: åˆ†äº«åŠŸèƒ½çš„é»æ“Šæ¬¡æ•¸
- **åˆ†äº«å¹³å°**: åˆ†äº«åˆ°å“ªäº›å¹³å°ï¼ˆéœ€è¨˜éŒ„ï¼‰

---

## ç³»çµ±ç›£æ§æ¨¡çµ„

### ç³»çµ±æ•ˆèƒ½ç›£æ§

#### API å›æ‡‰æ™‚é–“
- **ç›£æ§**: å„ API ç«¯é»çš„å¹³å‡å›æ‡‰æ™‚é–“
- **è­¦ç¤º**: è¶…é 1 ç§’éœ€é—œæ³¨

#### è³‡æ–™åº«æ•ˆèƒ½
- **æŸ¥è©¢æ™‚é–“**: æ…¢æŸ¥è©¢è¨˜éŒ„
- **é€£ç·šæ•¸**: è³‡æ–™åº«é€£ç·šæ•¸ç›£æ§

---

### éŒ¯èª¤ç›£æ§

#### éŒ¯èª¤çµ±è¨ˆ
- **éŒ¯èª¤é¡å‹**: 4xxã€5xx éŒ¯èª¤åˆ†é¡
- **éŒ¯èª¤é »ç‡**: å„éŒ¯èª¤çš„ç™¼ç”Ÿé »ç‡
- **éŒ¯èª¤è¿½è¹¤**: è©³ç´°éŒ¯èª¤æ—¥èªŒ

---

## åŒ¯å‡ºåŠŸèƒ½

### è³‡æ–™åŒ¯å‡º

#### Excel åŒ¯å‡º
- **æ¸¬é©—è¨˜éŒ„**: åŒ¯å‡ºæ‰€æœ‰æ¸¬é©—è¨˜éŒ„
- **ä½¿ç”¨è€…è³‡æ–™**: åŒ¯å‡ºä½¿ç”¨è€…åˆ—è¡¨
- **è«®è©¢è¨˜éŒ„**: åŒ¯å‡ºè«®è©¢åˆ—è¡¨
- **çµ±è¨ˆå ±è¡¨**: åŒ¯å‡ºçµ±è¨ˆæ•¸æ“š

#### PDF å ±è¡¨
- **æœˆå ±**: æ¯æœˆçµ±è¨ˆå ±è¡¨
- **å¹´å ±**: å¹´åº¦çµ±è¨ˆå ±è¡¨
- **è‡ªè¨‚å ±è¡¨**: ä¾æ¢ä»¶ç”Ÿæˆå ±è¡¨

---

## API è¨­è¨ˆ

### å„€è¡¨æ¿çµ±è¨ˆ API

```csharp
// GET /api/admin/dashboard/stats
public class DashboardStatsResponse
{
    public int TotalTests { get; set; }
    public decimal CompletionRate { get; set; }
    public int ActiveUsers { get; set; }
    public int PendingConsultations { get; set; }
    public List<TrendData> TestTrend { get; set; }
    public List<DistributionData> TestTypeDistribution { get; set; }
    public List<DistributionData> AgeDistribution { get; set; }
    public List<DistributionData> GenderDistribution { get; set; }
    public List<ActivityData> LatestTests { get; set; }
    public List<ActivityData> LatestConsultations { get; set; }
}
```

### æ¸¬é©—åˆ†æ API

```csharp
// GET /api/admin/analytics/test-completion
public class TestCompletionAnalysis
{
    public decimal OverallCompletionRate { get; set; }
    public List<TestCompletionData> ByTest { get; set; }
    public List<TrendData> CompletionTrend { get; set; }
}

// GET /api/admin/analytics/response-time
public class ResponseTimeAnalysis
{
    public decimal AverageTime { get; set; }
    public List<DistributionData> TimeDistribution { get; set; }
}
```

### ä½¿ç”¨è€…åˆ†æ API

```csharp
// GET /api/admin/analytics/users
public class UserAnalysis
{
    public int TotalUsers { get; set; }
    public int NewUsers { get; set; }
    public int ReturningUsers { get; set; }
    public List<DistributionData> TestCountDistribution { get; set; }
}

// GET /api/admin/analytics/retention
public class RetentionAnalysis
{
    public decimal Day1Retention { get; set; }
    public decimal Day7Retention { get; set; }
    public decimal Day30Retention { get; set; }
}
```

---

## å¯¦ä½œå„ªå…ˆé †åº

### ç¬¬ä¸€å„ªå…ˆï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… å„€è¡¨æ¿åŸºç¤çµ±è¨ˆï¼ˆ4å€‹æŒ‡æ¨™ï¼‰
2. âœ… åŸºç¤åœ–è¡¨ï¼ˆ4å€‹åœ–è¡¨ï¼‰
3. âœ… æ¸¬é©—å®Œæˆåº¦åˆ†æ

### ç¬¬äºŒå„ªå…ˆï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
4. âš ï¸ ä½œç­”æ™‚é–“åˆ†æ
5. âš ï¸ åˆ†æ•¸åˆ†å¸ƒåˆ†æ
6. âš ï¸ ä½¿ç”¨è€…ç•«åƒ

### ç¬¬ä¸‰å„ªå…ˆï¼ˆé€²éšåˆ†æï¼‰
7. ğŸ”µ ä½¿ç”¨è€…ç•™å­˜åˆ†æ
8. ğŸ”µ è«®è©¢åˆ†æ
9. ğŸ”µ å ±å‘Šåˆ†æ
10. ğŸ”µ ç³»çµ±ç›£æ§

---

## è³‡æ–™å„²å­˜å»ºè­°

### çµ±è¨ˆå¿«å–
- **å„€è¡¨æ¿è³‡æ–™**: å¿«å– 5 åˆ†é˜
- **åœ–è¡¨è³‡æ–™**: å¿«å– 10 åˆ†é˜
- **å ±è¡¨è³‡æ–™**: å¿«å– 1 å°æ™‚

### æ­·å²è³‡æ–™
- **å»ºè­°**: å»ºç«‹çµ±è¨ˆå¿«ç…§è¡¨ï¼Œæ¯æ—¥å„²å­˜çµ±è¨ˆæ•¸æ“š
- **ç›®çš„**: ä¿ç•™æ­·å²è¶¨å‹¢ï¼Œé¿å…é‡è¤‡è¨ˆç®—

```sql
CREATE TABLE dbo.DailyStats (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    StatDate DATE NOT NULL,
    TotalTests INT NOT NULL,
    CompletionRate DECIMAL(5,2) NOT NULL,
    ActiveUsers INT NOT NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETDATE(),
    CONSTRAINT UQ_DailyStats_Date UNIQUE (StatDate)
);
```

---

## ç¸½çµ

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å„€è¡¨æ¿çµ±è¨ˆï¼ˆ4æŒ‡æ¨™ + 4åœ–è¡¨ï¼‰
- âœ… æ¸¬é©—åˆ†æï¼ˆå®Œæˆåº¦ã€æ™‚é–“ã€åˆ†æ•¸ï¼‰
- âœ… ä½¿ç”¨è€…åˆ†æï¼ˆç•«åƒã€è¡Œç‚ºï¼‰

### é€²éšåŠŸèƒ½
- âš ï¸ ç•™å­˜åˆ†æ
- âš ï¸ è«®è©¢åˆ†æ
- âš ï¸ ç³»çµ±ç›£æ§

### é ä¼°å·¥ä½œé‡
- **æ ¸å¿ƒåŠŸèƒ½**: 5-7 å¤©
- **é€²éšåŠŸèƒ½**: 3-5 å¤©
- **ç¸½è¨ˆ**: 8-12 å¤©

