<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–é¤é€²åº¦ - é»é¤ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    maxWidth: {
                        'mobile': '480px'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- ä¸»å®¹å™¨ -->
    <div class="mx-auto max-w-mobile min-h-screen bg-white shadow-lg">
        <!-- æ¨™é¡Œåˆ— -->
        <header class="bg-green-600 text-white p-4">
            <h1 class="text-lg font-semibold">å–é¤é€²åº¦</h1>
            <div class="text-sm mt-1 opacity-90">æ­¥é©Ÿ 9/9 Â· å°åŒ—ä¿¡ç¾©åº— Â· å¤–å¸¶ Â· è¨‚å–®å®Œæˆ</div>
        </header>

        <!-- é€²åº¦æ¢ -->
        <div class="bg-gray-200 h-2">
            <div class="bg-green-600 h-2 transition-all duration-300" style="width: 100%"></div>
        </div>

        <!-- å…§å®¹å€ -->
        <main class="pb-20">
            <!-- è¨‚å–®æˆåŠŸæç¤º -->
            <div class="p-4 text-center">
                <div class="text-6xl mb-4">âœ…</div>
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">è¨‚å–®å·²ç¢ºèªï¼</h2>
                <p class="text-gray-600">æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼Œæˆ‘å€‘æ­£åœ¨ç‚ºæ‚¨æº–å‚™é¤é»</p>
            </div>

            <!-- å–é¤è³‡è¨Š -->
            <div class="px-4 pb-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-900">å–é¤è³‡è¨Š</h3>
                        <span class="text-sm text-gray-500" id="lastUpdated">å‰›å‰›æ›´æ–°</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">è¨‚å–®è™Ÿç¢¼</span>
                            <div class="font-mono text-lg font-semibold text-blue-600" id="orderNumber">ORD20240101001</div>
                        </div>
                        <div>
                            <span class="text-gray-600">å–é¤è™Ÿç¢¼</span>
                            <div class="font-mono text-lg font-semibold text-orange-600" id="pickupNumber">P0001</div>
                        </div>
                        <div>
                            <span class="text-gray-600">å–é¤é–€å¸‚</span>
                            <div class="font-medium">å°åŒ—ä¿¡ç¾©åº—</div>
                        </div>
                        <div>
                            <span class="text-gray-600">é ä¼°æ™‚é–“</span>
                            <div class="font-medium text-green-600" id="estimatedTime">15 åˆ†é˜</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¨‚å–®ç‹€æ…‹ -->
            <div class="px-4 pb-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">è£½ä½œé€²åº¦</h3>
                
                <div class="space-y-4" id="statusTimeline">
                    <!-- å·²æ¥å–® -->
                    <div class="flex items-start" id="status-RECEIVED">
                        <div class="w-8 h-8 rounded-full bg-green-600 flex items-center justify-center mr-4 mt-1">
                            <span class="text-white text-sm">âœ“</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900">å·²æ¥å–®</h4>
                            <p class="text-sm text-gray-600">æ‚¨çš„è¨‚å–®å·²ç¢ºèªï¼Œé–‹å§‹æº–å‚™è£½ä½œ</p>
                            <p class="text-xs text-gray-500" id="receivedTime">14:20</p>
                        </div>
                    </div>

                    <!-- è£½ä½œä¸­ -->
                    <div class="flex items-start" id="status-PREPARING">
                        <div class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center mr-4 mt-1">
                            <span class="text-white text-sm">â³</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900">è£½ä½œä¸­</h4>
                            <p class="text-sm text-gray-600">å»šæˆ¿æ­£åœ¨ç”¨å¿ƒç‚ºæ‚¨æº–å‚™é¤é»</p>
                            <p class="text-xs text-gray-500" id="preparingTime">14:22</p>
                        </div>
                    </div>

                    <!-- æº–å‚™å®Œæˆ -->
                    <div class="flex items-start opacity-50" id="status-READY">
                        <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 mt-1">
                            <span class="text-gray-400 text-sm">ğŸ””</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-400">æº–å‚™å®Œæˆ</h4>
                            <p class="text-sm text-gray-400">é¤é»å·²å®Œæˆï¼Œç­‰å¾…æ‚¨ä¾†å–é¤</p>
                            <p class="text-xs text-gray-400" id="readyTime">é ä¼° 14:35</p>
                        </div>
                    </div>

                    <!-- å·²å–é¤ -->
                    <div class="flex items-start opacity-50" id="status-PICKED_UP">
                        <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-4 mt-1">
                            <span class="text-gray-400 text-sm">ğŸ‘‹</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-400">å·²å–é¤</h4>
                            <p class="text-sm text-gray-400">æ„Ÿè¬æ‚¨çš„å…‰è‡¨ï¼Œç¥æ‚¨ç”¨é¤æ„‰å¿«</p>
                            <p class="text-xs text-gray-400" id="pickedUpTime">--:--</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å–é¤æé†’ -->
            <div class="px-4 pb-4">
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <div class="flex">
                        <div class="text-orange-600 mr-2">ğŸ“¢</div>
                        <div>
                            <h3 class="font-medium text-orange-800">å–é¤æé†’</h3>
                            <ul class="text-sm text-orange-700 mt-1 space-y-1">
                                <li>â€¢ è«‹åœ¨é¤é»æº–å‚™å®Œæˆå¾Œ 30 åˆ†é˜å…§å–é¤</li>
                                <li>â€¢ å–é¤æ™‚è«‹å‡ºç¤ºå–é¤è™Ÿç¢¼ï¼š<span class="font-mono font-semibold" id="pickupNumberReminder">P0001</span></li>
                                <li>â€¢ å¦‚æœ‰ç–‘å•è«‹æ´½æ«ƒæª¯ï¼š02-2345-6789</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä»˜æ¬¾è³‡è¨Š -->
            <div class="px-4 pb-4" id="paymentInfo">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ä»˜æ¬¾è³‡è¨Š</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ä»˜æ¬¾æ–¹å¼</span>
                            <span class="font-medium" id="paymentMethod">ç¾é‡‘ä»˜æ¬¾</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ä»˜æ¬¾ç‹€æ…‹</span>
                            <span class="font-medium" id="paymentStatus">å–é¤æ™‚ä»˜æ¬¾</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">æ‡‰ä»˜é‡‘é¡</span>
                            <span class="font-semibold text-blue-600" id="totalAmount">$200</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é–€å¸‚è³‡è¨Š -->
            <div class="px-4 pb-4">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">é–€å¸‚è³‡è¨Š</h3>
                    <div class="text-sm space-y-1">
                        <div><strong>å°åŒ—ä¿¡ç¾©åº—</strong></div>
                        <div class="text-gray-600">ğŸ“ ä¿¡ç¾©è·¯äº”æ®µ 7 è™Ÿ</div>
                        <div class="text-gray-600">ğŸ•’ ç‡Ÿæ¥­æ™‚é–“ï¼š10:00-22:00</div>
                        <div class="text-gray-600">ğŸ“ 02-2345-6789</div>
                    </div>
                    <button class="mt-3 w-full py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors text-sm" onclick="openMap()">
                        ğŸ“ æŸ¥çœ‹åœ°åœ–
                    </button>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å°è¦½ -->
        <footer class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-mobile bg-white border-t border-gray-200 p-4">
            <div class="flex gap-3">
                <button class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="refreshStatus()">
                    ğŸ”„ é‡æ–°æ•´ç†
                </button>
                <button class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="newOrder()">
                    ğŸ›’ å†æ¬¡é»é¤
                </button>
                <button class="px-4 py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors" onclick="goToStoreSelect()">
                    ğŸ 
                </button>
            </div>
        </footer>
    </div>

    <script>
        let currentStatus = 'PREPARING';
        let orderData = {};
        let paymentData = {};

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderData();
            updateOrderInfo();
            startStatusSimulation();
        });

        function loadOrderData() {
            orderData = JSON.parse(sessionStorage.getItem('finalOrder') || '{}');
            paymentData = JSON.parse(sessionStorage.getItem('paymentInfo') || '{}');
            
            // å¦‚æœæ²’æœ‰è¨‚å–®è³‡æ–™ï¼Œä½¿ç”¨ç¤ºä¾‹è³‡æ–™
            if (!orderData.orderNumber) {
                orderData = {
                    orderNumber: 'ORD20240101001',
                    pickupNumber: 'P0001',
                    orderStatus: 'PREPARING',
                    createdAt: new Date().toISOString(),
                    eta: new Date(Date.now() + 13 * 60 * 1000).toISOString()
                };
            }
            
            if (!paymentData.paymentMethod) {
                paymentData = {
                    paymentMethod: 'CASH',
                    paymentStatus: 'PENDING',
                    payableAmount: 200
                };
            }
        }

        function updateOrderInfo() {
            // æ›´æ–°è¨‚å–®è³‡è¨Š
            document.getElementById('orderNumber').textContent = orderData.orderNumber;
            document.getElementById('pickupNumber').textContent = orderData.pickupNumber;
            document.getElementById('pickupNumberReminder').textContent = orderData.pickupNumber;

            // æ›´æ–°æ™‚é–“
            const createdTime = new Date(orderData.createdAt);
            const etaTime = new Date(orderData.eta);
            const timeDiff = Math.max(0, Math.ceil((etaTime - new Date()) / 60000));
            
            document.getElementById('estimatedTime').textContent = timeDiff > 0 ? `${timeDiff} åˆ†é˜` : 'å³å°‡å®Œæˆ';
            document.getElementById('receivedTime').textContent = createdTime.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });

            const preparingTime = new Date(createdTime.getTime() + 2 * 60 * 1000);
            document.getElementById('preparingTime').textContent = preparingTime.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });

            // æ›´æ–°ä»˜æ¬¾è³‡è¨Š
            updatePaymentInfo();
            
            // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
            updateLastUpdatedTime();
        }

        function updatePaymentInfo() {
            const methodMap = {
                'CASH': 'ç¾é‡‘ä»˜æ¬¾',
                'CARD': 'ä¿¡ç”¨å¡ä»˜æ¬¾',
                'E_WALLET': 'é›»å­éŒ¢åŒ…ä»˜æ¬¾'
            };

            const statusMap = {
                'PENDING': 'å–é¤æ™‚ä»˜æ¬¾',
                'PAID': 'å·²ä»˜æ¬¾',
                'FAILED': 'ä»˜æ¬¾å¤±æ•—'
            };

            document.getElementById('paymentMethod').textContent = methodMap[paymentData.paymentMethod] || 'ç¾é‡‘ä»˜æ¬¾';
            document.getElementById('paymentStatus').textContent = statusMap[paymentData.paymentStatus] || 'å–é¤æ™‚ä»˜æ¬¾';
            document.getElementById('totalAmount').textContent = `$${paymentData.payableAmount || 200}`;

            // å¦‚æœå·²ä»˜æ¬¾ï¼Œé¡¯ç¤ºä»˜æ¬¾ç‹€æ…‹ç‚ºç¶ è‰²
            const statusElement = document.getElementById('paymentStatus');
            if (paymentData.paymentStatus === 'PAID') {
                statusElement.classList.add('text-green-600');
            }
        }

        function startStatusSimulation() {
            // æ¨¡æ“¬ç‹€æ…‹æ›´æ–°
            setTimeout(() => {
                if (currentStatus === 'PREPARING') {
                    updateStatusTo('READY');
                }
            }, 10000); // 10ç§’å¾Œè®Šç‚ºæº–å‚™å®Œæˆ

            setTimeout(() => {
                if (currentStatus === 'READY') {
                    updateStatusTo('PICKED_UP');
                }
            }, 30000); // 30ç§’å¾Œè®Šç‚ºå·²å–é¤
        }

        function updateStatusTo(newStatus) {
            currentStatus = newStatus;
            const statusElement = document.getElementById(`status-${newStatus}`);
            const timeElement = document.getElementById(`${newStatus.toLowerCase()}Time`);
            
            if (statusElement) {
                // ç§»é™¤ç°è‰²æ¨£å¼
                statusElement.classList.remove('opacity-50');
                
                // æ›´æ–°åœ“åœˆæ¨£å¼
                const circle = statusElement.querySelector('.w-8');
                const icon = statusElement.querySelector('.text-sm');
                const title = statusElement.querySelector('.font-medium');
                const description = statusElement.querySelector('.text-sm');
                
                if (newStatus === 'READY') {
                    circle.classList.remove('border-2', 'border-gray-300');
                    circle.classList.add('bg-blue-600');
                    icon.classList.remove('text-gray-400');
                    icon.classList.add('text-white');
                    title.classList.remove('text-gray-400');
                    title.classList.add('text-gray-900');
                    description.classList.remove('text-gray-400');
                    description.classList.add('text-gray-600');
                } else if (newStatus === 'PICKED_UP') {
                    circle.classList.remove('border-2', 'border-gray-300');
                    circle.classList.add('bg-green-600');
                    icon.classList.remove('text-gray-400');
                    icon.classList.add('text-white');
                    title.classList.remove('text-gray-400');
                    title.classList.add('text-gray-900');
                    description.classList.remove('text-gray-400');
                    description.classList.add('text-gray-600');
                }
                
                // æ›´æ–°æ™‚é–“
                if (timeElement) {
                    timeElement.textContent = new Date().toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    });
                    timeElement.classList.remove('text-gray-400');
                    timeElement.classList.add('text-gray-500');
                }
            }

            // ç‰¹æ®Šè™•ç†
            if (newStatus === 'READY') {
                // é¡¯ç¤ºæº–å‚™å®Œæˆé€šçŸ¥
                showNotification('ğŸ”” é¤é»å·²æº–å‚™å®Œæˆï¼', 'è«‹å‰å¾€æ«ƒæª¯å–é¤ï¼Œå–é¤è™Ÿç¢¼ï¼š' + orderData.pickupNumber);
            } else if (newStatus === 'PICKED_UP') {
                // é¡¯ç¤ºå–é¤å®Œæˆ
                showNotification('âœ… å–é¤å®Œæˆï¼', 'æ„Ÿè¬æ‚¨çš„å…‰è‡¨ï¼Œç¥æ‚¨ç”¨é¤æ„‰å¿«ï¼');
            }

            updateLastUpdatedTime();
        }

        function showNotification(title, message) {
            // ç°¡å–®çš„é€šçŸ¥æç¤º
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-mobile mx-4';
            notification.innerHTML = `
                <div class="font-semibold">${title}</div>
                <div class="text-sm opacity-90">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function updateLastUpdatedTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            document.getElementById('lastUpdated').textContent = `${timeString} æ›´æ–°`;
        }

        function refreshStatus() {
            // æ¨¡æ“¬é‡æ–°æ•´ç†
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'ğŸ”„ æ›´æ–°ä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                updateLastUpdatedTime();
                
                // æ¨¡æ“¬å°æ©Ÿç‡ç‹€æ…‹è®Šæ›´
                if (Math.random() < 0.3 && currentStatus === 'PREPARING') {
                    updateStatusTo('READY');
                }
            }, 1500);
        }

        function newOrder() {
            // æ¸…é™¤æ‰€æœ‰ sessionStorage è³‡æ–™
            sessionStorage.clear();
            window.location.href = 'store-select.html';
        }

        function goToStoreSelect() {
            window.location.href = 'store-select.html';
        }

        function openMap() {
            // æ¨¡æ“¬é–‹å•Ÿåœ°åœ–
            alert('å°‡é–‹å•Ÿ Google Maps å°èˆªè‡³å°åŒ—ä¿¡ç¾©åº—');
        }

        // æ¯ 30 ç§’è‡ªå‹•æ›´æ–°æ™‚é–“
        setInterval(updateLastUpdatedTime, 30000);
    </script>
</body>
</html>
