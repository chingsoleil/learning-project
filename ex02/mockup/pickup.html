<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–è²¨è³‡è¨Š - é»é¤ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    maxWidth: {
                        'mobile': '480px'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- ä¸»å®¹å™¨ -->
    <div class="mx-auto max-w-mobile min-h-screen bg-white shadow-lg">
        <!-- æ¨™é¡Œåˆ— -->
        <header class="bg-blue-600 text-white p-4">
            <h1 class="text-lg font-semibold">å–è²¨è³‡è¨Š</h1>
            <div class="text-sm mt-1 opacity-90">æ­¥é©Ÿ 7/9 Â· å°åŒ—ä¿¡ç¾©åº— Â· å¤–å¸¶</div>
        </header>

        <!-- é€²åº¦æ¢ -->
        <div class="bg-gray-200 h-2">
            <div class="bg-blue-600 h-2 transition-all duration-300" style="width: 77.7%"></div>
        </div>

        <!-- å…§å®¹å€ -->
        <main class="pb-20">
            <!-- å–è²¨é–€å¸‚ -->
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">å–è²¨é–€å¸‚</h2>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="text-2xl mr-3">ğŸª</div>
                        <div>
                            <h3 class="font-medium text-gray-900">å°åŒ—ä¿¡ç¾©åº—</h3>
                            <p class="text-sm text-gray-600 mt-1">ä¿¡ç¾©è·¯äº”æ®µ 7 è™Ÿ</p>
                            <p class="text-sm text-gray-500">ç‡Ÿæ¥­æ™‚é–“ï¼š10:00-22:00</p>
                            <p class="text-sm text-green-600 font-medium mt-1">ğŸ“ 02-2345-6789</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å–é¤æ™‚é–“ -->
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">å–é¤æ™‚é–“ <span class="text-red-500">*</span></h2>
                <div class="space-y-3">
                    <!-- ç«‹å³å–é¤ -->
                    <label class="block">
                        <input type="radio" name="pickupTime" value="now" class="sr-only" onchange="selectPickupTime('now')">
                        <div class="border-2 border-blue-500 bg-blue-50 rounded-lg p-4 cursor-pointer hover:border-blue-600 transition-all" id="pickup-now">
                            <div class="flex items-center">
                                <div class="w-6 h-6 border-2 border-blue-600 rounded-full mr-3 flex items-center justify-center">
                                    <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">ç«‹å³å–é¤</h3>
                                    <p class="text-sm text-gray-600">ç´„ 10-15 åˆ†é˜å¾Œå¯å–</p>
                                </div>
                                <div class="ml-auto text-sm text-blue-600 font-medium" id="nowTime">14:25</div>
                            </div>
                        </div>
                    </label>

                    <!-- é ç´„å–é¤ -->
                    <label class="block">
                        <input type="radio" name="pickupTime" value="scheduled" class="sr-only" onchange="selectPickupTime('scheduled')">
                        <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all" id="pickup-scheduled">
                            <div class="flex items-center">
                                <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                    <div class="w-3 h-3 bg-blue-600 rounded-full hidden"></div>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">é ç´„å–é¤</h3>
                                    <p class="text-sm text-gray-600">é¸æ“‡ç‰¹å®šæ™‚é–“</p>
                                </div>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- é ç´„æ™‚é–“é¸æ“‡ -->
                <div class="mt-4 hidden" id="scheduleOptions">
                    <div class="grid grid-cols-3 gap-2">
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('15:00')">15:00</button>
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('15:30')">15:30</button>
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('16:00')">16:00</button>
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('16:30')">16:30</button>
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('17:00')">17:00</button>
                        <button class="p-3 border border-gray-300 rounded-lg text-sm hover:border-blue-500 hover:bg-blue-50 transition-colors" onclick="selectScheduledTime('17:30')">17:30</button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">* é ç´„æ™‚é–“åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å–é¤æ™‚é–“å¯èƒ½å› è£½ä½œç‹€æ³èª¿æ•´</p>
                </div>
            </div>

            <!-- ç™¼ç¥¨è³‡è¨Š -->
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">ç™¼ç¥¨è³‡è¨Š</h2>
                
                <!-- ç™¼ç¥¨é¡å‹ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç™¼ç¥¨é¡å‹</label>
                    <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="invoiceType" onchange="toggleInvoiceFields()">
                        <option value="personal">å€‹äººç™¼ç¥¨</option>
                        <option value="company">å…¬å¸ç™¼ç¥¨</option>
                        <option value="donate">æè´ˆç™¼ç¥¨</option>
                    </select>
                </div>

                <!-- çµ±ä¸€ç·¨è™Ÿ -->
                <div class="mb-4 hidden" id="taxIdField">
                    <label class="block text-sm font-medium text-gray-700 mb-2">çµ±ä¸€ç·¨è™Ÿ</label>
                    <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è«‹è¼¸å…¥ 8 ä½æ•¸çµ±ä¸€ç·¨è™Ÿ" id="taxId" maxlength="8">
                </div>

                <!-- æ‰‹æ©Ÿè¼‰å…· -->
                <div class="mb-4" id="mobileCarrierField">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ‰‹æ©Ÿè¼‰å…·ï¼ˆé¸å¡«ï¼‰</label>
                    <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="/AB12345" id="mobileCarrier">
                    <p class="text-xs text-gray-500 mt-1">è«‹è¼¸å…¥æ‰‹æ©Ÿæ¢ç¢¼è¼‰å…·ï¼Œä¾‹å¦‚ï¼š/AB12345</p>
                </div>

                <!-- æè´ˆç¢¼ -->
                <div class="mb-4 hidden" id="donationCodeField">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æè´ˆç¢¼</label>
                    <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="donationCode">
                        <option value="">è«‹é¸æ“‡æè´ˆå°è±¡</option>
                        <option value="001">è²¡åœ˜æ³•äººå‰µä¸–ç¤¾æœƒç¦åˆ©åŸºé‡‘æœƒ</option>
                        <option value="002">è²¡åœ˜æ³•äººä¼Šç”¸ç¤¾æœƒç¦åˆ©åŸºé‡‘æœƒ</option>
                        <option value="003">è²¡åœ˜æ³•äººå–œæ†¨å…’ç¤¾æœƒç¦åˆ©åŸºé‡‘æœƒ</option>
                        <option value="004">è²¡åœ˜æ³•äººå®¶æ‰¶åŸºé‡‘æœƒ</option>
                    </select>
                </div>
            </div>

            <!-- è¨‚å–®å‚™è¨» -->
            <div class="p-4">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">è¨‚å–®å‚™è¨»</h2>
                <textarea class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚è«‹åœ¨æ­¤èªªæ˜ï¼ˆé¸å¡«ï¼‰" id="orderNote"></textarea>
            </div>

            <!-- è¨‚å–®ç¢ºèª -->
            <div class="p-4">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">è¨‚å–®ç¢ºèª</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">å–è²¨é–€å¸‚</span>
                            <span class="font-medium">å°åŒ—ä¿¡ç¾©åº—</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">å–é¤æ™‚é–“</span>
                            <span class="font-medium" id="selectedTime">ç«‹å³å–é¤ (14:25)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ç”¨é¤æ–¹å¼</span>
                            <span class="font-medium">å¤–å¸¶</span>
                        </div>
                        <div class="border-t border-gray-300 pt-2 mt-2">
                            <div class="flex justify-between">
                                <span class="text-lg font-semibold text-gray-900">æ‡‰ä»˜ç¸½é¡</span>
                                <span class="text-lg font-bold text-blue-600" id="finalTotal">$200</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å°è¦½ -->
        <footer class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-mobile bg-white border-t border-gray-200 p-4">
            <div class="flex gap-3">
                <button class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="goBack()">
                    è¿”å›
                </button>
                <button class="flex-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="proceedToPayment()">
                    ç¢ºèªé€å‡º
                </button>
                <button class="px-4 py-3 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors" onclick="goToStoreSelect()">
                    ğŸ 
                </button>
            </div>
        </footer>
    </div>

    <script>
        let selectedPickupType = 'now';
        let selectedScheduledTime = '';
        let orderSummary = {};

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderSummary();
            updateCurrentTime();
            updateFinalTotal();
        });

        function loadOrderSummary() {
            orderSummary = JSON.parse(sessionStorage.getItem('orderSummary') || '{"grandTotal":200}');
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            document.getElementById('nowTime').textContent = timeString;
        }

        function selectPickupTime(type) {
            selectedPickupType = type;

            // é‡ç½®æ¨£å¼
            document.querySelectorAll('[id^="pickup-"]').forEach(option => {
                option.classList.remove('border-blue-500', 'bg-blue-50');
                option.classList.add('border-gray-200');
                
                const radio = option.querySelector('.w-6 > div');
                const radioContainer = option.querySelector('.w-6');
                radio.classList.add('hidden');
                radioContainer.classList.remove('border-blue-600');
                radioContainer.classList.add('border-gray-300');
            });

            // è¨­å®šé¸ä¸­æ¨£å¼
            const selectedOption = document.getElementById(`pickup-${type}`);
            selectedOption.classList.remove('border-gray-200');
            selectedOption.classList.add('border-blue-500', 'bg-blue-50');
            
            const selectedRadio = selectedOption.querySelector('.w-6 > div');
            const selectedRadioContainer = selectedOption.querySelector('.w-6');
            selectedRadio.classList.remove('hidden');
            selectedRadioContainer.classList.remove('border-gray-300');
            selectedRadioContainer.classList.add('border-blue-600');

            // é¡¯ç¤º/éš±è—é ç´„æ™‚é–“é¸é …
            const scheduleOptions = document.getElementById('scheduleOptions');
            if (type === 'scheduled') {
                scheduleOptions.classList.remove('hidden');
            } else {
                scheduleOptions.classList.add('hidden');
                selectedScheduledTime = '';
            }

            updateSelectedTime();
        }

        function selectScheduledTime(time) {
            selectedScheduledTime = time;
            
            // é‡ç½®æ‰€æœ‰æ™‚é–“æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('#scheduleOptions button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-600');
                btn.classList.add('border-gray-300');
            });

            // è¨­å®šé¸ä¸­çš„æ™‚é–“æŒ‰éˆ•æ¨£å¼
            event.target.classList.remove('border-gray-300');
            event.target.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-600');

            updateSelectedTime();
        }

        function updateSelectedTime() {
            const selectedTimeElement = document.getElementById('selectedTime');
            if (selectedPickupType === 'now') {
                const currentTime = document.getElementById('nowTime').textContent;
                selectedTimeElement.textContent = `ç«‹å³å–é¤ (${currentTime})`;
            } else if (selectedPickupType === 'scheduled' && selectedScheduledTime) {
                selectedTimeElement.textContent = `é ç´„å–é¤ (${selectedScheduledTime})`;
            } else if (selectedPickupType === 'scheduled') {
                selectedTimeElement.textContent = 'é ç´„å–é¤ (è«‹é¸æ“‡æ™‚é–“)';
            }
        }

        function toggleInvoiceFields() {
            const invoiceType = document.getElementById('invoiceType').value;
            const taxIdField = document.getElementById('taxIdField');
            const mobileCarrierField = document.getElementById('mobileCarrierField');
            const donationCodeField = document.getElementById('donationCodeField');

            // éš±è—æ‰€æœ‰æ¬„ä½
            taxIdField.classList.add('hidden');
            mobileCarrierField.classList.add('hidden');
            donationCodeField.classList.add('hidden');

            // æ ¹æ“šç™¼ç¥¨é¡å‹é¡¯ç¤ºç›¸æ‡‰æ¬„ä½
            if (invoiceType === 'personal') {
                mobileCarrierField.classList.remove('hidden');
            } else if (invoiceType === 'company') {
                taxIdField.classList.remove('hidden');
                mobileCarrierField.classList.remove('hidden');
            } else if (invoiceType === 'donate') {
                donationCodeField.classList.remove('hidden');
            }
        }

        function updateFinalTotal() {
            const total = orderSummary.grandTotal || 200;
            document.getElementById('finalTotal').textContent = `$${total}`;
        }

        function proceedToPayment() {
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (selectedPickupType === 'scheduled' && !selectedScheduledTime) {
                alert('è«‹é¸æ“‡é ç´„å–é¤æ™‚é–“');
                return;
            }

            const invoiceType = document.getElementById('invoiceType').value;
            if (invoiceType === 'company') {
                const taxId = document.getElementById('taxId').value.trim();
                if (!taxId || taxId.length !== 8) {
                    alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ 8 ä½æ•¸çµ±ä¸€ç·¨è™Ÿ');
                    return;
                }
            }

            if (invoiceType === 'donate') {
                const donationCode = document.getElementById('donationCode').value;
                if (!donationCode) {
                    alert('è«‹é¸æ“‡æè´ˆå°è±¡');
                    return;
                }
            }

            // å„²å­˜å–è²¨è³‡è¨Š
            const pickupInfo = {
                pickupStoreId: '1',
                pickupStoreName: 'å°åŒ—ä¿¡ç¾©åº—',
                pickupType: selectedPickupType,
                pickupAt: selectedPickupType === 'now' ? new Date().toISOString() : 
                         selectedPickupType === 'scheduled' ? `2024-01-01T${selectedScheduledTime}:00.000Z` : null,
                invoiceType: invoiceType,
                taxId: document.getElementById('taxId').value.trim() || null,
                mobileCarrier: document.getElementById('mobileCarrier').value.trim() || null,
                donationCode: document.getElementById('donationCode').value || null,
                orderNote: document.getElementById('orderNote').value.trim() || null
            };

            sessionStorage.setItem('pickupInfo', JSON.stringify(pickupInfo));

            window.location.href = 'payment.html';
        }

        function goBack() {
            window.location.href = 'addons.html';
        }

        function goToStoreSelect() {
            window.location.href = 'store-select.html';
        }

        // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡æ™‚é–“
        setInterval(updateCurrentTime, 60000);
    </script>
</body>
</html>
