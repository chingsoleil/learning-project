# 測驗選題使用指南

## 📋 檔案說明

已建立 5 個測驗的 MD 檔範本：

1. **測驗1_大五人格快速評估.md** - 全面評估五大人格特質
2. **測驗2_職場人格評估.md** - 職場相關人格特質
3. **測驗3_情緒與人際關係.md** - 情緒管理與人際互動
4. **測驗4_創造力與開放性.md** - 創造力與學習能力
5. **測驗5_全面人格評估.md** - 多維度全面人格評估

每個 MD 檔包含：
- 測驗基本資訊（對應 TestPaper 表）
- 使用的 Instruments 和 Traits
- 選題條件和 SQL 查詢範例
- 題目清單表格（待填入）
- SQL INSERT 指令範本
- 選題檢查清單

---

## 🔍 選題方法

### 方法 1：使用 SQL 查詢（推薦）

#### 步驟 1：確認資料庫連接
確保 QuestionBank、InstrumentCategory、TraitCategory 表已匯入資料庫。

#### 步驟 2：執行 SQL 查詢
參考每個 MD 檔中的「選題 SQL 查詢範例」，修改 TraitCategoryId 和 InstrumentCategoryId，執行查詢。

#### 步驟 3：匯出結果
將查詢結果匯出為 CSV 或 Excel，方便整理。

#### 步驟 4：選題與排序
1. 按 Alpha 值排序，優先選擇信度高的題目
2. 平衡正向題（ScoringKey=1）和反向題（ScoringKey=-1）
3. 確保每個 trait 的題數符合需求
4. 隨機打亂順序

#### 步驟 5：填入 MD 檔
將選定的題目填入對應 MD 檔的「題目清單」表格。

### 方法 2：使用 Python 腳本

參考 `選題腳本概念.py`，修改配置後執行：

```bash
python 選題腳本概念.py
```

腳本會自動：
1. 讀取 QuestionBank.csv
2. 根據配置篩選題目
3. 平衡正向題和反向題
4. 隨機排序
5. 生成 MD 檔和 SQL INSERT 指令

### 方法 3：手動選題（Excel）

1. 在 Excel 中開啟 `QuestionBank.csv`
2. 使用「篩選」功能：
   - 篩選 InstrumentCategoryId
   - 篩選 TraitCategoryId
   - 篩選 Alpha >= 0.70
   - 篩選 IsActive = 1
3. 手動選擇 50 題
4. 整理成 MD 檔格式

---

## 📝 選題原則

### 1. 信度優先
- 優先選擇 `Alpha >= 0.75` 的題目
- 可接受範圍：`Alpha >= 0.70`
- 避免使用 `Alpha < 0.70` 的題目

### 2. 平衡性
- 每個 trait 需包含正向題和反向題
- 建議比例：正向題 60-70%，反向題 30-40%
- 如果某個 trait 沒有反向題，可從相關 trait 補充

### 3. 多樣性
- 避免 5 份測驗之間重複使用相同題目（相同 QuestionBankId）
- 同一 trait 的題目應分散，避免連續出現

### 4. 題數控制
- 每份測驗嚴格控制為 50 題
- 確保每個 trait 的題數符合規劃

---

## 🔧 生成 INSERT 指令

### 步驟 1：完成題目清單
在 MD 檔的「題目清單」表格中填入所有選定的 QuestionBankId。

### 步驟 2：生成 TestPaper INSERT
每個 MD 檔已包含 TestPaper INSERT 指令，直接使用即可。

### 步驟 3：生成 TestPaperDetail INSERT

#### 方法 A：手動生成
從 MD 檔的題目清單表格中，複製 QuestionBankId 和順序，填入 INSERT 指令範本。

#### 方法 B：使用 Excel
1. 將題目清單表格複製到 Excel
2. 使用公式生成 INSERT 語句：
   ```
   =CONCATENATE("    (", TestPaperId, ", ", QuestionBankId, ", ", 順序, ", 1),")
   ```
3. 複製所有生成的語句到 SQL 檔案

#### 方法 C：使用 Python 腳本
修改 `選題腳本概念.py`，讓它自動生成 INSERT 指令。

### 步驟 4：執行 INSERT
1. 先執行 TestPaper INSERT，記下生成的 Id
2. 將 TestPaperDetail INSERT 中的 TestPaperId 改為實際的 Id
3. 執行 TestPaperDetail INSERT

---

## ✅ 選題檢查清單

在完成選題後，請檢查：

### 每個測驗
- [ ] 總題數為 50 題
- [ ] 所有題目的 Alpha >= 0.70
- [ ] 每個 trait 的題數符合規劃
- [ ] 每個 trait 都有正向題和反向題
- [ ] 正向題與反向題比例約 60-70% : 30-40%
- [ ] 題目順序已隨機化
- [ ] 沒有重複的 QuestionBankId

### 跨測驗檢查
- [ ] 5 份測驗之間沒有重複的 QuestionBankId
- [ ] 所有測驗的 Code 都是唯一的
- [ ] 所有題目都有中文翻譯（TextZh）

---

## 📊 統計資訊填寫

完成選題後，在每個 MD 檔的「統計資訊」區塊填入：

- **總題數**：應為 50
- **正向題數**：ScoringKey=1 的題目數量
- **反向題數**：ScoringKey=-1 的題目數量
- **平均 Alpha**：所有題目的 Alpha 平均值
- **最低 Alpha**：所有題目中的最低 Alpha 值
- **使用的 Instruments 分布**：各 Instrument 的題數分布

---

## 🚀 下一步

1. **選題**：根據每個 MD 檔的選題條件，從題庫中選出 50 題
2. **填入**：將選定的題目填入 MD 檔的「題目清單」表格
3. **檢查**：使用選題檢查清單確認品質
4. **生成 SQL**：根據題目清單生成 INSERT 指令
5. **執行**：在資料庫中執行 INSERT 指令
6. **驗證**：查詢資料庫確認資料正確

---

## 📚 相關文件

- `測驗設計原則文件.md` - 完整的設計原則和規劃
- `選題流程說明.md` - 詳細的選題流程
- `選題腳本概念.py` - Python 選題腳本範例
- `題庫檢視報告.md` - 題庫資料檢視報告

---

## ⚠️ 注意事項

1. **TestPaperId 處理**：
   - TestPaper INSERT 後，Id 會自動生成
   - 需將 TestPaperDetail INSERT 中的 TestPaperId 改為實際值
   - 或使用變數：`DECLARE @TestPaperId INT; SET @TestPaperId = SCOPE_IDENTITY();`

2. **Code 唯一性**：
   - 每份測驗的 Code 必須唯一
   - 如果 Code 已存在，INSERT 會失敗

3. **外鍵約束**：
   - QuestionBankId 必須存在於 QuestionBank 表
   - 如果 QuestionBankId 不存在，INSERT 會失敗

4. **題目順序**：
   - QuestionOrder 應為 1-50 的連續數字
   - 建議隨機排序，避免受測者猜測模式

