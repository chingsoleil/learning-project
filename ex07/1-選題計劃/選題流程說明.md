# 測驗選題流程說明

## 一、選題策略

### 1.1 選題原則
1. **信度優先**：優先選擇 `Alpha ≥ 0.75` 的題目，其次選擇 `Alpha ≥ 0.70` 的題目
2. **平衡性**：每個 trait 需包含正向題（ScoringKey=1）與反向題（ScoringKey=-1）
3. **多樣性**：避免重複使用相同題目（相同 QuestionBankId）
4. **隨機化**：題目順序隨機排列，避免同一 trait 連續出現

### 1.2 選題步驟

#### 步驟 1：確定測驗需求
根據 `測驗設計原則文件.md` 確定：
- 使用的 Instruments（InstrumentCategoryId）
- 使用的 Traits（TraitCategoryId）
- 每個 Trait 需要的題數

#### 步驟 2：從題庫篩選
從 `QuestionBank.csv` 中篩選符合條件的題目：
- `InstrumentCategoryId` 符合需求
- `TraitCategoryId` 符合需求
- `Alpha >= 0.70`
- `IsActive = 1`

#### 步驟 3：題目分配
- 按 `Alpha` 值降序排列，優先選擇信度高的題目
- 確保每個 trait 的正向題與反向題比例約 60-70% : 30-40%
- 如果某個 trait 的題目不足，可從相關 trait 補充

#### 步驟 4：題目排序
- 將所有選定的題目隨機打亂
- 確保同一 trait 的題目不連續出現（盡量分散）
- 正向題與反向題交替出現（盡量）

#### 步驟 5：品質檢核
- 確認總題數為 50 題
- 確認所有題目的 `Alpha >= 0.70`
- 確認正向題與反向題比例合理
- 確認沒有重複題目

---

## 二、MD 檔格式設計

### 2.1 檔案結構

每個測驗的 MD 檔應包含以下部分：

1. **測驗基本資訊**（對應 TestPaper 表）
2. **題目清單**（對應 TestPaperDetail 表）
3. **統計資訊**（用於檢核）

### 2.2 MD 檔範本

```markdown
# 測驗名稱

## 測驗基本資訊

| 欄位 | 值 |
|------|-----|
| Name | 測驗名稱 |
| Code | 測驗代碼（唯一） |
| Description | 測驗說明 |
| ResponseType | Likert5 |
| TimeLimit | 20（分鐘） |
| TotalQuestions | 50 |
| IsActive | 1 |

## 使用的 Instruments

- InstrumentName (Id: X)
- InstrumentName (Id: Y)

## 使用的 Traits

- TraitName (Id: X) - 10題
- TraitName (Id: Y) - 8題

## 題目清單

| 順序 | QuestionBankId | 題目文字 | Trait | Instrument | Alpha | ScoringKey | IsRequired |
|------|----------------|---------|-------|-----------|-------|-----------|-----------|
| 1 | 1234 | 題目內容... | TraitName | InstrumentName | 0.85 | 1 | 1 |
| 2 | 5678 | 題目內容... | TraitName | InstrumentName | 0.82 | -1 | 1 |

## 統計資訊

- 總題數：50
- 正向題數：32 (64%)
- 反向題數：18 (36%)
- 平均 Alpha：0.81
- 最低 Alpha：0.70
```

---

## 三、INSERT 指令生成規則

### 3.1 TestPaper INSERT

```sql
INSERT INTO TestPaper (Name, Code, Description, ResponseType, TimeLimit, TotalQuestions, IsActive)
VALUES ('測驗名稱', 'TEST_CODE_01', '測驗說明', 'Likert5', 20, 50, 1);
```

**注意**：Id 會自動生成，不需要指定。

### 3.2 TestPaperDetail INSERT

```sql
-- 假設 TestPaper 的 Id 為 1（實際需根據 INSERT 後的結果調整）
INSERT INTO TestPaperDetail (TestPaperId, QuestionBankId, QuestionOrder, IsRequired)
VALUES 
    (1, 1234, 1, 1),
    (1, 5678, 2, 1),
    -- ... 共 50 題
    (1, 9999, 50, 1);
```

**注意**：
- TestPaperId 需要先執行 TestPaper 的 INSERT，取得生成的 Id
- 或者使用變數：`DECLARE @TestPaperId INT; SET @TestPaperId = SCOPE_IDENTITY();`

---

## 四、實際選題方法

由於題庫有 3,805 題，建議使用以下方法：

### 方法 1：SQL 查詢選題（推薦）
1. 將 QuestionBank.csv 匯入資料庫
2. 使用 SQL 查詢篩選和排序
3. 匯出結果到 CSV
4. 手動調整和確認
5. 轉換為 MD 檔格式

### 方法 2：Python 腳本選題
1. 讀取 QuestionBank.csv
2. 根據條件篩選
3. 隨機排序
4. 輸出為 MD 檔

### 方法 3：手動選題
1. 在 Excel 中開啟 QuestionBank.csv
2. 使用篩選功能找出符合條件的題目
3. 手動選擇 50 題
4. 整理成 MD 檔格式

---

## 五、注意事項

1. **題目唯一性**：確保 5 份測驗之間沒有重複的 QuestionBankId
2. **順序隨機化**：題目順序應隨機，避免受測者猜測模式
3. **平衡性檢查**：每個 trait 都應有正向題和反向題
4. **信度要求**：所有題目的 Alpha 都應 >= 0.70
5. **Code 唯一性**：每份測驗的 Code 必須唯一

